{% extends 'base.html' %} {% block content %}
<div class="max-w-3xl mx-auto py-12">
  <div class="relative flex items-center justify-center w-full mb-6">
    <!-- Stylish Back Button -->
    <button
      id="backButton"
      class="absolute left-0 flex items-center gap-2 px-4 py-2 bg-gray-300 text-gray-700 font-medium rounded-full shadow-md hover:bg-gray-400 hover:shadow-lg transition-all duration-300 hidden"
      onclick="prevStep()"
    >
      <i class="fas fa-arrow-left"></i>
    </button>

    <!-- Title (Centered) -->
    <h2 class="text-2xl font-bold text-center">Create Placement Profile</h2>
  </div>

  <form
    method="POST"
    enctype="multipart/form-data"
    id="wizardForm"
    class="space-y-6"
    onsubmit="showLoadingOverlay()"
  >
    {% csrf_token %}

    <!-- Last Name (Step 4) -->
    <div class="form-step hidden" id="step1">
      <!-- Sub-Step Container -->
      <div class="sub-step" id="subStep1">
        <div
          class="max-w-2xl mx-auto bg-teal-100 mt-10 border-l-4 border-teal-500 p-6 rounded-lg shadow-md flex items-start space-x-4"
        >
          <i
            class="fas fa-info-circle text-teal-600 text-3xl flex-shrink-0"
          ></i>
          <div class="flex-1">
            <h3 class="text-xl font-semibold text-teal-700">
              Peak College Student Responsibilities
            </h3>
            <ul class="list-none text-gray-800 mt-3 space-y-3 text-lg">
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Ensure my
                tuition fee is settled to avoid delays.
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Submit
                clear and readable placement documents for approval by the
                Placement Team.
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Resubmit
                documents that were rejected due to unclear submission.
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Ensure the
                college has my updated home address.
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Regularly
                check my email for document approval notifications and
                coordinate with the Placement Team.
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Wait for
                an email confirmation once all required documents are approved
                and tuition fee is fully paid.
              </li>
            </ul>
            <div class="mt-5 flex items-center">
              <input
                type="checkbox"
                id="subStep1Checkbox"
                class="w-6 h-6 text-teal-600 border-gray-300 rounded focus:ring-teal-500"
              />
              <label for="subStep1Checkbox" class="ml-3 text-gray-800 text-lg">
                I have read and understood my responsibilities listed for
                placement.
              </label>
            </div>
            <p id="subStep1Error" class="text-red-600 text-lg mt-2 hidden">
              You must acknowledge this section before proceeding.
            </p>
          </div>
        </div>
        <div class="flex justify-center mt-4">
          <button
            type="button"
            class="px-6 py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300"
            onclick="goToSubStep(2)"
          >
            Next <i class="fas fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>

      <!-- Substeps 2–7 (see below for full content) -->
      <div class="sub-step hidden" id="subStep2">
        <div
          class="max-w-2xl mx-auto bg-teal-100 mt-10 border-l-4 border-teal-500 p-6 rounded-lg shadow-md flex items-start space-x-4"
        >
          <i
            class="fas fa-clipboard-list text-teal-600 text-3xl flex-shrink-0 mt-1"
          ></i>
          <div class="flex-1 h-[500px] overflow-y-auto pr-4">
            <h3 class="text-xl font-semibold text-teal-700">
              Before Placement Responsibilities
            </h3>
            <ul class="list-none text-gray-800 mt-3 space-y-3 text-lg">
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Submit
                required documents:
              </li>
              <ul class="ml-8 list-none space-y-2">
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i>
                  Medical Report with supporting lab results or proof of
                  immunization for:
                </li>
                <ul class="ml-8 list-none space-y-2">
                  <li>
                    <i class="fas fa-circle text-teal-400 text-xs mr-2"></i>
                    2-Step TB Test (or Chest X-ray if skin test is positive).
                    Must be within 6 months for LTC placements.
                  </li>
                  <li>
                    <i class="fas fa-circle text-teal-400 text-xs mr-2"></i> MMR
                    (Measles, Mumps, Rubella), Varicella, Tdap (Tetanus,
                    Diphtheria, Pertussis), and Hepatitis B.
                  </li>
                </ul>
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i> Police
                  Vulnerable Sector Check (VSC) – Criminal and Judicial Checks
                  are NOT accepted. Must be within 6 months for LTC placements.
                </li>
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i>
                  COVID-19 Vaccination Certificate – Proof of two doses required
                  (see Placement Guide for details).
                </li>
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i> First
                  Aid & CPR (Level C).
                </li>
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i> Mask
                  Fit Test Certificate.
                </li>
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i> Flu
                  Shot Record (for fall/winter intakes).
                </li>
              </ul>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Pregnancy
                Policy:
              </li>
              <ul class="ml-8 list-none space-y-2">
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i> 1st &
                  3rd trimester: not allowed.
                </li>
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i> 2nd
                  trimester: allowed with doctor's note and facility approval.
                </li>
              </ul>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Do not
                contact facilities directly. All communication is handled by the
                college.
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Placements
                are offered based on document completion and availability.
                Suggesting facilities is allowed, but communication goes through
                the college.
              </li>
            </ul>
            <div class="mt-5 flex items-center">
              <input
                type="checkbox"
                id="subStep2Checkbox"
                class="w-6 h-6 text-teal-600 border-gray-300 rounded focus:ring-teal-500"
              />
              <label for="subStep2Checkbox" class="ml-3 text-gray-800 text-lg">
                I have read and understood my responsibilities listed for
                placement.
              </label>
            </div>
            <p id="subStep2Error" class="text-red-600 text-lg mt-2 hidden">
              Please confirm you have read and understood the responsibilities.
            </p>
          </div>
        </div>
        <div class="flex justify-between mt-4">
          <button
            type="button"
            class="flex items-center gap-2 px-4 py-2 bg-white border border-teal-400 text-teal-700 font-semibold rounded-full shadow hover:bg-teal-50 hover:shadow-lg transition-all duration-300 text-sm sm:text-base"
            onclick="goToSubStepBack(2)"
          >
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button
            onclick="goToSubStep(3)"
            class="w-full sm:w-auto px-4 py-2 sm:px-6 sm:py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300 text-sm sm:text-base ml-2"
          >
            Next <i class="fas fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>

      <div class="sub-step hidden" id="subStep3">
        <div
          class="max-w-2xl mx-auto bg-teal-100 mt-10 border-l-4 border-teal-500 p-6 rounded-lg shadow-md flex items-start space-x-4"
        >
          <i class="fas fa-university text-teal-600 text-3xl flex-shrink-0"></i>
          <div class="flex-1">
            <h3 class="text-xl font-semibold text-teal-700">
              College Responsibilities
            </h3>
            <ul class="list-none text-gray-800 mt-3 space-y-3 text-lg">
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Review
                documents and confirm eligibility.
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Ensure
                student has zero tuition balance.
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Coordinate
                placement logistics (proposal, agreement, status).
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Provide
                orientation and relevant policies.
              </li>
            </ul>
            <div class="mt-5 flex items-center">
              <input
                type="checkbox"
                id="subStep3Checkbox"
                class="w-6 h-6 text-teal-600 border-gray-300 rounded focus:ring-teal-500"
              />
              <label for="subStep3Checkbox" class="ml-3 text-gray-800 text-lg">
                I have read and understood my responsibilities listed for
                placement.</label
              >
            </div>
            <p id="subStep3Error" class="text-red-600 text-lg mt-2 hidden">
              I have read and understood my responsibilities listed for
              placement.
            </p>
          </div>
        </div>
        <div class="flex justify-between mt-4">
          <button
            type="button"
            class="flex items-center gap-2 px-4 py-2 bg-white border border-teal-400 text-teal-700 font-semibold rounded-full shadow hover:bg-teal-50 hover:shadow-lg transition-all duration-300 text-sm sm:text-base"
            onclick="goToSubStepBack(3)"
          >
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button
            onclick="goToSubStep(4)"
            class="w-full sm:w-auto px-4 py-2 sm:px-6 sm:py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300 text-sm sm:text-base ml-2"
          >
            Next <i class="fas fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>
      {% comment %}
      <div class="sub-step hidden" id="subStep4">
        <div
          class="max-w-2xl mx-auto bg-teal-100 mt-10 border-l-4 border-teal-500 p-6 rounded-lg shadow-md flex items-start space-x-4"
        >
          <i
            class="fas fa-hospital-symbol text-teal-600 text-3xl flex-shrink-0"
          ></i>
          <div class="flex-1">
            <h3 class="text-xl font-semibold text-teal-700">
              Facility Responsibilities
            </h3>
            <ul class="list-none text-gray-800 mt-3 space-y-3 text-lg">
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Confirm
                capacity and schedule.
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Share
                intake and orientation dates.
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Share
                number of available spots.
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Share
                shift schedule and shift requirements.
              </li>
            </ul>
            <div class="mt-5 flex items-center">
              <input
                type="checkbox"
                id="subStep4Checkbox"
                class="w-6 h-6 text-teal-600 border-gray-300 rounded focus:ring-teal-500"
              />
              <label for="subStep4Checkbox" class="ml-3 text-gray-800 text-lg">
                I have read and understood my responsibilities listed for
                placement</label
              >
            </div>
            <p id="subStep4Error" class="text-red-600 text-lg mt-2 hidden">
              I have read and understood my responsibilities listed for
              placement
            </p>
          </div>
        </div>
        <div class="flex justify-center mt-4">
          <button
            onclick="goToSubStep(5)"
            class="px-6 py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300"
          >
            Next <i class="fas fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>
      {% endcomment %}
      <div class="sub-step hidden" id="subStep4">
        <div
          class="max-w-2xl mx-auto bg-teal-100 mt-10 border-l-4 border-teal-500 p-6 rounded-lg shadow-md flex items-start space-x-4"
        >
          <i class="fas fa-user-clock text-teal-600 text-3xl flex-shrink-0"></i>
          <div class="flex-1 h-[500px] overflow-y-auto pr-4">
            <h3 class="text-xl font-semibold text-teal-700">
              During Placement
            </h3>
            <ul class="list-none text-gray-800 mt-3 space-y-3 text-lg">
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i
                ><strong>Student Expectations:</strong>
              </li>
              <ul class="ml-8 list-none space-y-2">
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i
                  ><strong>Attendance & Punctuality:</strong>
                </li>
                <ul class="ml-8 list-none space-y-1">
                  <li>
                    <i class="fas fa-circle text-teal-400 text-xs mr-2"></i
                    >Report absences to both college and facility via email.
                  </li>
                  <li>
                    <i class="fas fa-circle text-teal-400 text-xs mr-2"></i>More
                    than 2 absences require explanation.
                  </li>
                  <li>
                    <i class="fas fa-circle text-teal-400 text-xs mr-2"></i>No
                    unauthorized schedule changes.
                  </li>
                </ul>

                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i
                  ><strong>Illness:</strong>
                </li>
                <ul class="ml-8 list-none space-y-1">
                  <li>
                    <i class="fas fa-circle text-teal-400 text-xs mr-2"></i
                    >Immediately notify both the facility and college.
                  </li>
                </ul>

                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i
                  ><strong>Commitment:</strong>
                </li>
                <ul class="ml-8 list-none space-y-1">
                  <li>
                    <i class="fas fa-circle text-teal-400 text-xs mr-2"></i
                    >Placement site cannot be changed once assigned.
                  </li>
                </ul>

                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i
                  ><strong>Professional Conduct:</strong>
                </li>
                <ul class="ml-8 list-none space-y-1">
                  <li>
                    <i class="fas fa-circle text-teal-400 text-xs mr-2"></i
                    >Respect workplace policies and people.
                  </li>
                  <li>
                    <i class="fas fa-circle text-teal-400 text-xs mr-2"></i
                    >Disrespectful or abusive behavior may lead to disciplinary
                    action.
                  </li>
                </ul>
              </ul>

              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i
                ><strong>College Support:</strong>
              </li>
              <ul class="ml-8 list-none space-y-1">
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i>Monitor
                  student performance.
                </li>
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i>Conduct
                  mid-placement check-ins.
                </li>
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i
                  >Maintain accurate placement records.
                </li>
              </ul>

              {% comment %}
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i
                ><strong>Facility Responsibilities:</strong>
              </li>
              <ul class="ml-8 list-none space-y-1">
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i>Provide
                  supervision and orientation.
                </li>
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i>Notify
                  college of any student issues.
                </li>
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i>Submit
                  preceptor evaluations by placement end.
                </li>
              </ul>
              {% endcomment %}
            </ul>
            <div class="mt-5 flex items-center">
              <input
                type="checkbox"
                id="subStep4Checkbox"
                class="w-6 h-6 text-teal-600 border-gray-300 rounded focus:ring-teal-500"
              />
              <label for="subStep4Checkbox" class="ml-3 text-gray-800 text-lg">
                I have read and understood my responsibilities listed for
                placement.
              </label>
            </div>
            <p id="subStep4Error" class="text-red-600 text-lg mt-2 hidden">
              Please acknowledge the responsibilities by checking the box above.
            </p>
          </div>
        </div>
        <div class="flex justify-between mt-4">
          <button
            type="button"
            class="flex items-center gap-2 px-4 py-2 bg-white border border-teal-400 text-teal-700 font-semibold rounded-full shadow hover:bg-teal-50 hover:shadow-lg transition-all duration-300 text-sm sm:text-base"
            onclick="goToSubStepBack(4)"
          >
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button
            onclick="goToSubStep(5)"
            class="w-full sm:w-auto px-4 py-2 sm:px-6 sm:py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300 text-sm sm:text-base ml-2"
          >
            Next <i class="fas fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>

      <div class="sub-step hidden" id="subStep5">
        <div
          class="max-w-2xl mx-auto bg-teal-100 mt-10 border-l-4 border-teal-500 p-6 rounded-lg shadow-md flex items-start space-x-4"
        >
          <i class="fas fa-handshake text-teal-600 text-3xl flex-shrink-0"></i>
          <div class="flex-1">
            <h3 class="text-xl font-semibold text-teal-700">
              After Placement Responsibilities
            </h3>
            <ul class="list-none text-gray-800 mt-3 space-y-3 text-lg">
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i
                ><strong>Student Responsibilities:</strong>
              </li>
              <ul class="ml-8 list-none space-y-2">
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i>Email
                  the college with exact placement end date.
                </li>
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i>Submit:
                </li>
                <ul class="ml-8 list-none space-y-1">
                  <li>
                    <i class="fas fa-circle text-teal-400 text-xs mr-2"></i
                    >Completed Timesheet (Skills Passbook or Facility Log
                    Sheet).
                  </li>
                  <li>
                    <i class="fas fa-circle text-teal-400 text-xs mr-2"></i
                    >Preceptor Evaluation.
                  </li>
                </ul>
              </ul>

              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i
                ><strong>College Responsibilities:</strong>
              </li>
              <ul class="ml-8 list-none space-y-2">
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i>Verify
                  placement hours and evaluation.
                </li>
                <li>
                  <i class="fas fa-chevron-right text-teal-500 mr-2"></i>File
                  documentation for records.
                </li>
              </ul>
            </ul>
            <div class="mt-5 flex items-center">
              <input
                type="checkbox"
                id="subStep5Checkbox"
                class="w-6 h-6 text-teal-600 border-gray-300 rounded focus:ring-teal-500"
              />
              <label for="subStep5Checkbox" class="ml-3 text-gray-800 text-lg">
                I have read and understood my responsibilities listed for
                placement.
              </label>
            </div>
            <p id="subStep5Error" class="text-red-600 text-lg mt-2 hidden">
              Please acknowledge the responsibilities by checking the box above.
            </p>
          </div>
        </div>
        <div class="flex justify-between mt-4">
          <button
            type="button"
            class="flex items-center gap-2 px-4 py-2 bg-white border border-teal-400 text-teal-700 font-semibold rounded-full shadow hover:bg-teal-50 hover:shadow-lg transition-all duration-300 text-sm sm:text-base"
            onclick="goToSubStepBack(5)"
          >
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button
            onclick="goToSubStep(6)"
            class="w-full sm:w-auto px-4 py-2 sm:px-6 sm:py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300 text-sm sm:text-base ml-2"
          >
            Next <i class="fas fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>

      <div class="sub-step hidden" id="subStep6">
        <div
          class="max-w-2xl mx-auto bg-teal-100 mt-10 border-l-4 border-teal-500 p-6 rounded-lg shadow-md flex items-start space-x-4"
        >
          <i class="fas fa-handshake text-teal-600 text-3xl flex-shrink-0"></i>
          <div class="flex-1">
            <h3 class="text-xl font-semibold text-teal-700">
              Conduct & Respect Policy
            </h3>
            <p class="text-gray-800 mt-2 text-lg">
              Peak College adheres to the Occupational Health and Safety Act
              (OHSA) and the Ontario Human Rights Code (OHRC) to ensure a
              respectful, inclusive learning environment.
            </p>
            <h4 class="mt-4 font-semibold text-teal-700 text-lg">
              Unacceptable Behaviors Include:
            </h4>
            <ul class="list-none text-gray-800 mt-2 space-y-2 text-lg">
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Dismissive
                or demeaning acts
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Public
                embarrassment
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i>
                Undermining work
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Harassment
                or discrimination
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i>
                Retaliation for reporting concerns
              </li>
            </ul>
            <h4 class="mt-4 font-semibold text-teal-700 text-lg">
              Expectations:
            </h4>
            <ul class="list-none text-gray-800 mt-2 space-y-2 text-lg">
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Treat
                everyone with dignity and respect
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i>
                Communicate professionally
              </li>
              <li>
                <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Report
                violations confidentially and safely
              </li>
            </ul>
            <div class="mt-5 flex items-center">
              <input
                type="checkbox"
                id="subStep6Checkbox"
                class="w-6 h-6 text-teal-600 border-gray-300 rounded focus:ring-teal-500"
              />
              <label for="subStep6Checkbox" class="ml-3 text-gray-800 text-lg">
                I have read and understood the Conduct and Respect Policy.
              </label>
            </div>
            <p id="subStep6Error" class="text-red-600 text-lg mt-2 hidden">
              Please acknowledge the policy by checking the box above.
            </p>
          </div>
        </div>
        <div class="flex justify-between mt-4">
          <button
            type="button"
            class="flex items-center gap-2 px-4 py-2 bg-white border border-teal-400 text-teal-700 font-semibold rounded-full shadow hover:bg-teal-50 hover:shadow-lg transition-all duration-300 text-sm sm:text-base"
            onclick="goToSubStepBack(6)"
          >
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button
            onclick="goToSubStep(7)"
            class="w-full sm:w-auto px-4 py-2 sm:px-6 sm:py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300 text-sm sm:text-base ml-2"
          >
            Next <i class="fas fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>

      <div class="sub-step hidden" id="subStep7">
        <div
          class="max-w-2xl mx-auto bg-teal-100 mt-10 border-l-4 border-teal-500 p-6 rounded-lg shadow-md flex items-start space-x-4"
        >
          <i
            class="fas fa-envelope-open-text text-teal-600 text-3xl flex-shrink-0 mt-1"
          ></i>
          <div class="flex-1 h-[400px] overflow-y-auto pr-4">
            <h3 class="text-xl font-semibold text-teal-700">
              Communication, Hours & Stipend Policy
            </h3>
            <ul class="list-none text-gray-800 mt-3 space-y-4 text-lg">
              <!-- COMMUNICATION POLICY -->
              <li>
                <strong class="text-teal-700">Communication Policy</strong>
              </li>
              <ul class="ml-6 space-y-2">
                <li>
                  <i class="fas fa-arrow-right text-teal-600 mr-2"></i> All
                  formal communication must be via email.
                </li>
                <li>
                  <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Expect
                  responses within 1–2 business days.
                </li>
                <li>
                  <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Contact:
                  <a
                    href="mailto:placement@peakcollege.ca"
                    class="text-teal-700 underline"
                    >placement@peakcollege.ca</a
                  >
                </li>
              </ul>

              <!-- PLACEMENT HOURS & ACCREDITATION -->
              <li class="pt-2">
                <strong class="text-teal-700"
                  >Placement Hours & Accreditation Evaluation</strong
                >
              </li>
              <ul class="ml-6 space-y-2">
                <li>
                  <i class="fas fa-arrow-right text-teal-600 mr-2"></i>
                  Placement Requirement: 300 hours.
                </li>
                <li>
                  <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Other
                  recognized credentials (evaluated case-by-case with proof):
                </li>
                <ul class="ml-6 space-y-1">
                  <li>
                    <i class="fas fa-chevron-right text-teal-500 mr-2"></i> IEN
                    (Diploma & Transcript)
                  </li>
                  <li>
                    <i class="fas fa-chevron-right text-teal-500 mr-2"></i>
                    HCSW/Elderly Care (Certificate & Job Description)
                  </li>
                  <li>
                    <i class="fas fa-chevron-right text-teal-500 mr-2"></i> PSW
                    Experience (Letter of Employment)
                  </li>
                </ul>
              </ul>

              <!-- CLINICAL STIPEND POLICY -->
              <li class="pt-2">
                <strong class="text-teal-700">Clinical Stipend Policy</strong>
              </li>
              <ul class="ml-6 space-y-2">
                <li>
                  <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Paid
                  placements are limited and not guaranteed.
                </li>
                <li>
                  <i class="fas fa-arrow-right text-teal-600 mr-2"></i>
                  Availability is subject to:
                </li>
                <ul class="ml-6 space-y-1">
                  <li>
                    <i class="fas fa-chevron-right text-teal-500 mr-2"></i>
                    Facility capacity and discretion
                  </li>
                  <li>
                    <i class="fas fa-chevron-right text-teal-500 mr-2"></i>
                    Provincial guidelines (Ministry of Health & Ontario Health)
                  </li>
                </ul>
                <li>
                  <i class="fas fa-arrow-right text-teal-600 mr-2"></i> Peak
                  College does not manage or distribute stipends; payments (if
                  any) are handled by the facility or provincial agency.
                </li>
              </ul>
            </ul>

            <!-- Acknowledgment Checkbox -->
            <div class="mt-6 flex items-center">
              <input
                type="checkbox"
                id="subStep7Checkbox"
                class="w-6 h-6 text-teal-600 border-gray-300 rounded focus:ring-teal-500"
              />
              <label for="subStep7Checkbox" class="ml-3 text-gray-800 text-lg">
                I have read and understood my responsibilities listed for
                placement.
              </label>
            </div>
            <p id="subStep7Error" class="text-red-600 text-lg mt-2 hidden">
              Please acknowledge this section before finishing.
            </p>
          </div>
        </div>

        <div class="flex justify-between mt-4">
          <button
            type="button"
            class="flex items-center gap-2 px-4 py-2 bg-white border border-teal-400 text-teal-700 font-semibold rounded-full shadow hover:bg-teal-50 hover:shadow-lg transition-all duration-300 text-sm sm:text-base"
            onclick="goToSubStepBack(7)"
          >
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button
            onclick="goToSubStep(8)"
            class="w-full sm:w-auto px-4 py-2 sm:px-6 sm:py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300 text-sm sm:text-base ml-2"
          >
            Next <i class="fas fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>

      <div class="sub-step hidden" id="subStep8">
        <div
          class="max-w-2xl mx-auto bg-teal-100 mt-10 border-l-4 border-teal-500 p-6 rounded-lg shadow-md flex items-start space-x-4"
        >
          <i
            class="fas fa-envelope-open-text text-teal-600 text-3xl flex-shrink-0 mt-1"
          ></i>
          <div class="flex-1 h-[400px] overflow-y-auto pr-4">
            <!-- Gender Selection Grid -->
            <!-- Gender Selection Grid -->
            <div class="mt-6">
              <h4 class="text-teal-700 font-semibold text-lg mb-2">
                Select Your Gender
              </h4>
              <div
                id="genderSelector"
                class="grid grid-cols-2 sm:grid-cols-4 gap-4"
              >
                <button
                  type="button"
                  onclick="selectGender('Male')"
                  id="gender-Male"
                  class="flex flex-col items-center justify-center p-4 border border-teal-300 rounded-lg hover:bg-teal-100 cursor-pointer transition duration-200"
                >
                  <i class="fas fa-mars text-2xl mb-1"></i>
                  <span>Male</span>
                </button>
                <button
                  type="button"
                  onclick="selectGender('Female')"
                  id="gender-Female"
                  class="flex flex-col items-center justify-center p-4 border border-teal-300 rounded-lg hover:bg-teal-100 cursor-pointer transition duration-200"
                >
                  <i class="fas fa-venus text-2xl mb-1"></i>
                  <span>Female</span>
                </button>
                <button
                  type="button"
                  onclick="selectGender('Other')"
                  id="gender-Other"
                  class="flex flex-col items-center justify-center p-4 border border-teal-300 rounded-lg hover:bg-teal-100 cursor-pointer transition duration-200"
                >
                  <i class="fas fa-genderless text-2xl mb-1"></i>
                  <span>Other</span>
                </button>
                <button
                  type="button"
                  onclick="selectGender('Prefer not to say')"
                  id="gender-Prefer not to say"
                  class="flex flex-col items-center justify-center p-4 border border-teal-300 rounded-lg hover:bg-teal-100 cursor-pointer transition duration-200"
                >
                  <i class="fas fa-user-secret text-2xl mb-1"></i>
                  <span>Prefer not to say</span>
                </button>
              </div>
              <input type="hidden" name="gender" id="gender" />
              <p id="genderError" class="text-red-600 text-lg mt-2 hidden">
                Please select a gender before continuing.
              </p>
            </div>
            <!-- Pregnancy Policy Notice (hidden by default) -->
            <div
              id="pregnancyNotice"
              class="mt-6 p-4 bg-yellow-100 border-l-4 border-yellow-500 rounded hidden"
            >
              <h5 class="text-yellow-700 font-semibold mb-2">
                Please read our:
              </h5>
              <button
                type="button"
                onclick="openPregnancyModal()"
                class="inline-block px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition text-sm sm:text-base font-semibold shadow"
              >
                Pregnancy Policy & Waiver for Clinical Placement
              </button>
              <div class="mt-4 flex flex-col items-start gap-2 w-full">
                <div class="flex items-center gap-2 w-full">
                  <input
                    type="checkbox"
                    id="genderAcknowledgement"
                    class="mt-1 h-5 w-5 text-teal-600 border-gray-300 rounded focus:ring-teal-500"
                    onchange="toggleNextButton()"
                    disabled
                  />
                  <label
                    for="genderAcknowledgement"
                    class="text-gray-700 text-sm flex-1"
                  >
                    I acknowledge the information provided above and confirm my
                    selection.
                  </label>
                </div>
                <div id="waiverSuccessMsg" class="hidden w-full flex flex-col items-center justify-center mt-3">
                  <div class="flex items-center gap-2 bg-green-100 border border-green-300 rounded-full px-4 py-2 shadow w-full sm:w-auto justify-center">
                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                    <span class="text-green-700 font-semibold text-base">Waiver Uploaded successfully!</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="flex justify-between mt-4">
          <button
            type="button"
            class="flex items-center gap-2 px-4 py-2 bg-white border border-teal-400 text-teal-700 font-semibold rounded-full shadow hover:bg-teal-50 hover:shadow-lg transition-all duration-300 text-sm sm:text-base"
            onclick="goToSubStepBack(8)"
          >
            <i class="fas fa-arrow-left"></i> Back
          </button>
          <button
            id="nextstep_2"
            type="button"
            disabled
            class="w-full sm:w-auto px-4 py-2 sm:px-6 sm:py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300 text-sm sm:text-base ml-2"
            onclick="nextStep(2)"
          >
            Next <i class="fas fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>

      <script>
        function selectGender(gender) {
          const options = ["Male", "Female", "Other", "Prefer not to say"];
          options.forEach((opt) => {
            const el = document.getElementById("gender-" + opt);
            if (el) {
              el.classList.remove(
                "bg-teal-500",
                "text-white",
                "border-teal-600",
                "shadow-lg"
              );
              el.classList.add("border-teal-300", "hover:bg-teal-100");
            }
          });

          const selectedTile = document.getElementById("gender-" + gender);
          if (selectedTile) {
            selectedTile.classList.add(
              "bg-teal-500",
              "text-white",
              "border-teal-600",
              "shadow-lg"
            );
            selectedTile.classList.remove(
              "border-teal-300",
              "hover:bg-teal-100"
            );
          }

          document.getElementById("gender").value = gender;
          document.getElementById("genderError").classList.add("hidden");

          const pregnancyNotice = document.getElementById("pregnancyNotice");
          const checkbox = document.getElementById("genderAcknowledgement");
          const nextButton = document.getElementById("nextstep_2");

          if (gender === "Female") {
            pregnancyNotice.classList.remove("hidden");
            checkbox.checked = false;
            checkbox.disabled = true;
            nextButton.disabled = true;
          } else {
            pregnancyNotice.classList.add("hidden");
            checkbox.checked = true;
            checkbox.disabled = false;
            nextButton.disabled = false;
          }
        }

        function toggleNextButton() {
          const checkbox = document.getElementById("genderAcknowledgement");
          const gender = document.getElementById("gender").value;
          const nextButton = document.getElementById("nextstep_2");

          if (gender === "Female") {
            nextButton.disabled = !checkbox.checked;
          } else {
            nextButton.disabled = false;
          }
        }
        // Modal open/close
        function openPregnancyModal() {
          document.getElementById('pregnancyPolicyModal').classList.remove('hidden');
          document.body.classList.add('overflow-hidden');
          document.getElementById('genderAcknowledgement').disabled = true;
          document.getElementById('waiverSuccessMsg').classList.add('hidden');
        }
        function closePregnancyModal() {
          document.getElementById('pregnancyPolicyModal').classList.add('hidden');
          document.body.classList.remove('overflow-hidden');
        }
        // Drag and drop for signature
        let signatureFile = null;
        document.addEventListener('DOMContentLoaded', function() {
          const dropzone = document.getElementById('signatureDropzone');
          const fileInput = document.getElementById('pregnancy_signature_file');
          const preview = document.getElementById('signaturePreview');
          const errorDiv = document.getElementById('signatureError');
          const dropText = document.getElementById('signatureDropText');
          if (!dropzone) return;
          function showSignaturePreview(file) {
            preview.innerHTML = '';
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
              const img = document.createElement('img');
              img.src = e.target.result;
              img.alt = 'Signature Preview';
              img.className = 'max-h-32 rounded shadow mb-2';
              preview.appendChild(img);
              // Remove button
              const removeBtn = document.createElement('button');
              removeBtn.type = 'button';
              removeBtn.textContent = 'Remove';
              removeBtn.className = 'mt-1 px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-xs font-semibold';
              removeBtn.onclick = function() {
                signatureFile = null;
                fileInput.value = '';
                preview.innerHTML = '';
                dropText.classList.remove('hidden');
              };
              preview.appendChild(removeBtn);
            };
            reader.readAsDataURL(file);
            dropText.classList.add('hidden');
          }
          dropzone.addEventListener('dragover', function(e) {
            e.preventDefault();
            dropzone.classList.add('border-teal-600', 'bg-teal-100');
          });
          dropzone.addEventListener('dragleave', function(e) {
            e.preventDefault();
            dropzone.classList.remove('border-teal-600', 'bg-teal-100');
          });
          dropzone.addEventListener('drop', function(e) {
            e.preventDefault();
            dropzone.classList.remove('border-teal-600', 'bg-teal-100');
            const file = e.dataTransfer.files[0];
            handleSignatureFile(file);
          });
          dropzone.addEventListener('click', function(e) {
            if (e.target === dropzone) fileInput.click();
          });
          fileInput.addEventListener('change', function() {
            const file = fileInput.files[0];
            handleSignatureFile(file);
          });
          function handleSignatureFile(file) {
            errorDiv.classList.add('hidden');
            if (!file) return;
            if (!file.type.startsWith('image/')) {
              errorDiv.textContent = 'Only image files are allowed.';
              errorDiv.classList.remove('hidden');
              fileInput.value = '';
              return;
            }
            if (file.size > 2 * 1024 * 1024) {
              errorDiv.textContent = 'File size must be 2MB or less.';
              errorDiv.classList.remove('hidden');
              fileInput.value = '';
              return;
            }
            signatureFile = file;
            showSignaturePreview(file);
          }
          document.getElementById('waiverSaveBtn').addEventListener('click', function(e) {
            e.preventDefault();
            let valid = true;
            // Validate file
            if (!signatureFile) {
              errorDiv.textContent = 'Signature image is required.';
              errorDiv.classList.remove('hidden');
              valid = false;
            } else {
              errorDiv.classList.add('hidden');
            }
            // Validate date
            const dateInput = document.getElementById('signed_on_date');
            const dateError = document.getElementById('dateError');
            if (!dateInput.value) {
              dateError.textContent = 'Date is required.';
              dateError.classList.remove('hidden');
              valid = false;
            } else {
              dateError.classList.add('hidden');
            }
            if (!valid) return false;
            // AJAX submit
            const formData = new FormData();
            formData.append('pregnancy_signature_file', signatureFile);
            formData.append('signed_on_date', dateInput.value);
            fetch('/update-pregnancy-signature/', {
              method: 'POST',
              headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': (document.querySelector('[name=csrfmiddlewaretoken]') || {}).value || ''
              },
              body: formData
            })
            .then(response => response.json().then(data => ({status: response.status, body: data})))
            .then(({status, body}) => {
              if (body.success) {
                // Show success, enable checkbox, do not close modal
                document.getElementById('genderAcknowledgement').disabled = false;
                document.getElementById('waiverSuccessMsg').classList.remove('hidden');
                closePregnancyModal();
              } else if (body.errors) {
                if (body.errors.pregnancy_signature_file) {
                  errorDiv.textContent = body.errors.pregnancy_signature_file;
                  errorDiv.classList.remove('hidden');
                }
                if (body.errors.signed_on_date) {
                  dateError.textContent = body.errors.signed_on_date;
                  dateError.classList.remove('hidden');
                }
              }
            })
            .catch(() => {
              errorDiv.textContent = 'An error occurred. Please try again.';
              errorDiv.classList.remove('hidden');
            });
            return false;
          });
        });
      </script>

      <!-- You can copy the rest of the sub-steps from here: -->
    </div>

    <div class="form-step hidden" id="step2">
      <!-- Display Read-Only User Details -->
      <div
        class="bg-white p-6 rounded-2xl shadow-lg border border-gray-200 mb-5"
      >
        <h3 class="text-xl font-bold text-gray-800 mb-4">Your Details</h3>

        <div class="space-y-3">
          <div class="flex items-center">
            <span class="font-semibold text-gray-700 w-40">First Name:</span>
            <span class="text-gray-600">{{ first_name }}</span>
          </div>

          <div class="flex items-center">
            <span class="font-semibold text-gray-700 w-40">Last Name:</span>
            <span class="text-gray-600">{{ last_name }}</span>
          </div>

          <div class="flex items-center">
            <span class="font-semibold text-gray-700 w-40">College Email:</span>
            <span class="text-gray-600">{{ college_email }}</span>
          </div>
        </div>
      </div>

      <div class="flex justify-center mt-4">
        <button
          type="button"
          class="px-6 py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300"
          onclick="nextStep(3)"
        >
          Next <i class="fas fa-arrow-right ml-2"></i>
        </button>
      </div>
    </div>

    <!-- Address Updated Dropdown (Step 4) -->
    <div class="form-step hidden bg-white p-6 rounded-lg shadow-lg" id="step3">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">
        Current Address Information
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="flex flex-col">
          <label for="apt_house_no" class="text-lg font-medium text-gray-700"
            >Apt/House No.</label
          >
          <input
            type="text"
            name="apt_house_no"
            id="apt_house_no"
            class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

        <div class="flex flex-col">
          <label for="street" class="text-lg font-medium text-gray-700"
            >Street <strong style="color: red">*</strong></label
          >
          <input
            type="text"
            name="street"
            id="street"
            required
            class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

        <div class="flex flex-col">
          <label for="city_0" class="text-lg font-medium text-gray-700"
            >City <strong style="color: red">*</strong></label
          >
          <select
            name="city_0"
            id="city_0"
            required
            class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            onchange="toggleMunicipalityDropdown()"
          >
            <option value="">Select a city</option>
          </select>
        </div>

        <div class="flex flex-col">
          <label for="province" class="text-lg font-medium text-gray-700">
            Province <strong style="color: red">*</strong>
          </label>
          <select
            name="province"
            id="province"
            required
            class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="" disabled selected>Select your province</option>
            <option value="Alberta (AB)">Alberta (AB)</option>
            <option value="British Columbia (BC)">British Columbia (BC)</option>
            <option value="Manitoba (MB)">Manitoba (MB)</option>
            <option value="New Brunswick (NB)">New Brunswick (NB)</option>
            <option value="Newfoundland and Labrador (NL)">
              Newfoundland and Labrador (NL)
            </option>
            <option value="Nova Scotia (NS)">Nova Scotia (NS)</option>
            <option value="Ontario (ON)">Ontario (ON)</option>
            <option value="Prince Edward Island (PE)">
              Prince Edward Island (PE)
            </option>
            <option value="Quebec (QC)">Quebec (QC)</option>
            <option value="Saskatchewan (SK)">Saskatchewan (SK)</option>
            <option value="Northwest Territories (NT)">
              Northwest Territories (NT)
            </option>
            <option value="Nunavut (NU)">Nunavut (NU)</option>
            <option value="Yukon (YT)">Yukon (YT)</option>
          </select>
        </div>

        <div class="flex flex-col">
          <label for="postal_code" class="text-lg font-medium text-gray-700"
            >Postal Code <strong style="color: red">*</strong></label
          >
          <input
            type="text"
            name="postal_code"
            id="postal_code"
            required
            class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

         <!-- Municipality Dropdown (only if city is Toronto) -->
         <div class="flex flex-col" id="municipalityDiv" style="display:none;">
          <label for="municipality" class="text-lg font-medium text-gray-700">
            Municipality <strong style="color: red">*</strong>
          </label>
          <select
            name="municipality"
            id="municipality"
            class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="" selected disabled>Select your area</option>
            <option value="Downtown">Downtown</option>
            <option value="Etobicoke">Etobicoke</option>
            <option value="Scarborough">Scarborough</option>
            <option value="North York">North York</option>
            <option value="East York">East York</option>
            <option value="York">York</option>
          </select>
          <p id="municipalityError" class="text-red-600 text-sm mt-1 hidden">
            Please select your municipality.
          </p>
        </div>

        <div class="flex flex-col md:col-span-2">
          <label
            for="open_to_outside_city"
            class="text-lg font-medium text-gray-700"
          >
            Are you open to completing your placement outside your city when there is a slot available for you? 
            <span class="block mt-2 text-sm text-gray-600">
              Please note that if we do not have an existing contract with the facility, we cannot guarantee the timeline for establishing one. The process may take additional time, and availability could be affected.
            </span>
          </label>
          <select
            name="open_to_outside_city"
            id="open_to_outside_city"
            onchange="toggleCityPreferences()"
            class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="No">No</option>
            <option value="Yes">Yes</option>
          </select>
        </div>
        

        <!-- Hidden initially -->
        <div id="cityPreferences" class="hidden md:col-span-2">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
            <div class="flex flex-col">
              <label
                for="city_preference_1"
                class="text-lg font-medium text-gray-700"
              >
                City Preference 2 <strong style="color: red">*</strong>
              </label>
              <select
                name="city_preference_1"
                id="city_preference_1"
                class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="">Select a city</option>
              </select>
              <p
                id="cityPreferenceError"
                class="text-red-600 text-sm mt-1 hidden"
              >
                Please select your first city preference.
              </p>
            </div>

            <div class="flex flex-col">
              <label
                for="city_preference_2"
                class="text-lg font-medium text-gray-700"
              >
                City Preference 3
              </label>
              <select
                name="city_preference_2"
                id="city_preference_2"
                class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="">Select a city</option>
              </select>
            </div>
          </div>
        </div>

       

       
      </div>

      <div class="flex justify-center items-center mt-6">
        <button
          type="button"
          class="px-6 py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300"
          onclick="if (validateMunicipalityIfNeeded() && validateCityPreferenceIfNeeded()) nextStep(4);"
        >
          Next <i class="fas fa-arrow-right ml-2"></i>
        </button>
      </div>
    </div>

    <script>
      function toggleCityPreferences() {
        const openToOutside = document.getElementById(
          "open_to_outside_city"
        ).value;
        const cityPreferencesDiv = document.getElementById("cityPreferences");
        const city1 = document.getElementById("city_preference_1");

        if (openToOutside === "Yes") {
          cityPreferencesDiv.classList.remove("hidden");
          loadCityDropdowns();
          loadCityDropdowns_city_1_2();
        } else {
          cityPreferencesDiv.classList.add("hidden");
          city1.value = ""; // Clear previous selection
          city1.classList.remove("border-red-500"); // Remove error style if present
        }
      }

      function validateCityPreferenceIfNeeded() {
        const openToOutside = document.getElementById(
          "open_to_outside_city"
        ).value;
        const city1 = document.getElementById("city_preference_1");
        const errorMsg = document.getElementById("cityPreferenceError");

        if (openToOutside === "Yes" && !city1.value) {
          city1.classList.add("border-red-500");
          errorMsg.classList.remove("hidden");
          return false;
        } else {
          city1.classList.remove("border-red-500");
          errorMsg.classList.add("hidden");
          return true;
        }
      }

      function loadCityDropdowns_city_1_2() {
        fetch("/cities-and-provinces/") // Replace with your actual endpoint
          .then((response) => response.json())
          .then((data) => {
            const dropdown1 = document.getElementById("city_preference_1");
            const dropdown2 = document.getElementById("city_preference_2");

            // Clear old options
            dropdown1.innerHTML = '<option value="">Select a city</option>';
            dropdown2.innerHTML = '<option value="">Select a city</option>';

            // Loop through each province and its cities
            for (const province in data) {
              const cities = data[province];

              // Create an <optgroup> for better UX
              const group1 = document.createElement("optgroup");
              group1.label = province;

              const group2 = document.createElement("optgroup");
              group2.label = province;

              cities.forEach((city) => {
                const option1 = new Option(city, city);
                const option2 = new Option(city, city);
                group1.appendChild(option1);
                group2.appendChild(option2);
              });

              dropdown1.appendChild(group1);
              dropdown2.appendChild(group2);
            }
          })
          .catch((error) => {
            console.error("Error loading cities:", error);
          });
      }
    </script>

    <script>
      function toggleMunicipalityDropdown() {
        const cityDropdown = document.getElementById('city_0');
        const municipalityDiv = document.getElementById('municipalityDiv');
        const municipalitySelect = document.getElementById('municipality');
        if (cityDropdown.value.trim().toLowerCase() === 'toronto') {
          municipalityDiv.style.display = '';
          municipalitySelect.setAttribute('required', 'required');
        } else {
          municipalityDiv.style.display = 'none';
          municipalitySelect.value = '';
          municipalitySelect.removeAttribute('required');
        }
      }

      // Validate municipality before next step
      function validateMunicipalityIfNeeded() {
        const cityDropdown = document.getElementById('city_0');
        const municipalitySelect = document.getElementById('municipality');
        const errorMsg = document.getElementById('municipalityError');
        if (cityDropdown.value.trim().toLowerCase() === 'toronto' && !municipalitySelect.value) {
          municipalitySelect.classList.add('border-red-500');
          errorMsg.classList.remove('hidden');
          return false;
        } else {
          municipalitySelect.classList.remove('border-red-500');
          errorMsg.classList.add('hidden');
          return true;
        }
      }

      // Patch the Next button validation to include municipality
      document.addEventListener('DOMContentLoaded', function() {
        const addressNextBtn = document.querySelector('#step3 button[type="button"]');
        if (addressNextBtn) {
          const origHandler = addressNextBtn.onclick;
          addressNextBtn.onclick = function() {
            if (validateMunicipalityIfNeeded() && validateCityPreferenceIfNeeded()) {
              if (typeof origHandler === 'function') origHandler();
              else nextStep(4);
            }
          };
        }
      });

      // Populate city_0 dropdown from /cities-and-provinces/ with Ontario first
      function loadCityDropdowns() {
        fetch("/cities-and-provinces/")
          .then((response) => response.json())
          .then((data) => {
            const dropdown0 = document.getElementById("city_0");
            // Clear old options
            dropdown0.innerHTML = '<option value="">Select a city</option>';
            // Ontario first, then the rest
            const provinces = Object.keys(data);
            const reorderedProvinces = [];
            if (provinces.includes("Ontario (ON)")) {
              reorderedProvinces.push("Ontario (ON)");
            }
            provinces.forEach((prov) => {
              if (prov !== "Ontario (ON)") {
                reorderedProvinces.push(prov);
              }
            });
            reorderedProvinces.forEach((province) => {
              const cities = data[province];
              // Create an <optgroup> for better UX
              const group0 = document.createElement("optgroup");
              group0.label = province;
              cities.forEach((city) => {
                const option0 = new Option(city, city);
                group0.appendChild(option0);
              });
              dropdown0.appendChild(group0);
            });
          })
          .catch((error) => {
            console.error("Error loading cities:", error);
          });
      }
      document.addEventListener("DOMContentLoaded", function () {
        loadCityDropdowns();
        loadCityDropdowns_city_1_2();
      });
    </script>

    <!-- Experience Level Dropdown (Step 4) -->
    <div class="form-step hidden bg-white p-6 rounded-lg shadow-lg" id="step4">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">
        Related PSW Experience
      </h2>

      <div class="flex flex-col">
        <label
          for="experience_level"
          class="text-lg font-medium text-gray-700 mb-2"
          >Experience Level</label
        >
        <select
          name="experience_level"
          id="experience_level"
          onchange="handleExperienceChange(); setUserExperience(); handleExperienceChangeSelect();"
          class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option value="Select your experience">Select your experience</option>
          <option value="No Experience">No Experience</option>
          <option value="1 Year PSW Experience">One (1) Year PSW Experience in Canada</option>
          <option value="International Nurse">Internationally Educated Nurse (IEN)</option>
          <option value="Caregiver Experience">Caregiver Experience in Canada</option>
        </select>
      </div>
      <!-- Required Placement Hours (auto-filled) -->
      <div class="flex flex-col mt-4">
        <label for="placement_hours" class="text-lg font-medium text-gray-700 mb-2">Required Placement Hours</label>
        <input type="number" id="placement_hours" name="placement_hours" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-100" readonly required />
      </div>
      <script>
        function updatePlacementHours() {
          const experience = document.getElementById("experience_level").value;
          const placementHoursInput = document.getElementById("placement_hours");
          if (experience === "No Experience") {
            placementHoursInput.value = 300;
          } else if (
            experience === "1 Year PSW Experience" ||
            experience === "International Nurse" ||
            experience === "Caregiver Experience"
          ) {
            placementHoursInput.value = 200;
          } else {
            placementHoursInput.value = "";
          }
        }
        // Run on page load
        document.addEventListener("DOMContentLoaded", updatePlacementHours);
        // Run on change
        document.getElementById("experience_level").addEventListener("change", updatePlacementHours);
      </script>

      <div class="flex justify-center items-center mt-6">
        <button
          type="button"
          class="next-button-experience-select px-6 py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300 opacity-50 cursor-not-allowed"
          onclick="nextStep(5); handleExperienceChange()"
          disabled
        >
          Next <i class="fas fa-arrow-right ml-2"></i>
        </button>
      </div>
      <script>
        function handleExperienceChangeSelect() {
          const experienceSelect = document.getElementById("experience_level");
          const nextButtonExperience = document.querySelector(
            ".next-button-experience-select"
          );

          if (experienceSelect.value === "Select your experience") {
            nextButtonExperience.setAttribute("disabled", "true");
            nextButtonExperience.classList.add(
              "opacity-50",
              "cursor-not-allowed"
            );
          } else {
            nextButtonExperience.removeAttribute("disabled");
            nextButtonExperience.classList.remove(
              "opacity-50",
              "cursor-not-allowed"
            );
          }
        }
        document
          .getElementById("experience_level")
          .addEventListener("change", handleExperienceChangeSelect);
        document.addEventListener("mousemove", handleExperienceChangeSelect);
      </script>
    </div>

    <!-- Required Document Upload (Step 5) -->
    <div class="form-step hidden bg-white p-6 rounded-lg shadow-lg" id="step5">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">
        Upload Required Document/s
      </h2>

      <div class="flex flex-col hidden" id="document_upload">
        <label
          id="document_label"
          class="text-lg font-medium text-gray-700 mb-2"
        ></label>
        <input
          type="file"
          name="experience_document"
          id="experience_document"
          class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          onchange="validateFileUpload()"
        />
        <p id="sampleNote" class="text-sm text-green-600 mt-1">
          See Sample Letter with all the necessary information.
          <a
            href="https://drive.google.com/file/d/1QZuUOlSnvabe4pzWd2wCKuVLlfFTOpkt/view"
            class="text-blue-500 hover:underline"
            >Click here</a
          >.
        </p>
        <p id="noteText" class="text-sm text-green-600 mt-1">
          Note: If the submitted document/s lack all necessary information, the
          document will be rejected.
        </p>
      </div>

      <div class="flex justify-center items-center mt-6">
        <button
          type="button"
          id="nextButton"
          class="next-button-experience px-6 py-3 bg-gray-400 text-white font-semibold rounded-full shadow-md cursor-not-allowed transition-all duration-300"
          disabled
          onclick="nextStep(6)"
        >
          Next <i class="fas fa-arrow-right ml-2"></i>
        </button>
      </div>
      <script>
        function handleExperienceChange() {
          const experienceSelect = document.getElementById("experience_level");
          const experience = experienceSelect.value;
          const uploadDiv = document.getElementById("document_upload");
          const uploadLabel = document.getElementById("document_label");
          const step4nextButton = document.querySelector("#step4 button");
          const nextButtons = document.querySelectorAll(
            ".next-button-experience"
          );
          const nextButtonExperience = document.querySelector(
            ".next-button-experience"
          );
          // Set placement hours based on experience
          const placementHoursInput = document.getElementById("placement_hours");
          if (placementHoursInput) {
            if (experience === "No Experience") {
              placementHoursInput.value = 300;
            } else if (
              experience === "1 Year PSW Experience" ||
              experience === "International Nurse" ||
              experience === "Caregiver Experience"
            ) {
              placementHoursInput.value = 200;
            } else {
              placementHoursInput.value = "";
            }
          }

          // Show/Hide document upload section
          if (experience === "No Experience") {
            uploadDiv.classList.add("hidden");
            nextButtons.forEach((btn) => {
              btn.classList.remove("cursor-not-allowed", "bg-gray-400");
              btn.classList.add(
                "bg-teal-500",
                "hover:bg-teal-600",
                "hover:shadow-lg"
              );
              btn.disabled = false;
            });
          } else {
            uploadDiv.classList.remove("hidden");
            nextButtonExperience.classList.add(
              "opacity-50",
              "cursor-not-allowed"
            );
            nextButtonExperience.disabled = true;
          }

          const sampleNote = document.getElementById("sampleNote");
          const noteText = document.getElementById("noteText");

          // Show or hide sample note based on selection
          if (experience === "International Nurse") {
            sampleNote.classList.add("hidden");
            noteText.textContent =
              "Note: If the submitted document/s lack all necessary information, the document will be rejected.";
          } else {
            sampleNote.classList.remove("hidden");
            noteText.textContent =
              "Note: If the submitted document/s lack all necessary information, the document will be rejected.";
          }

          // Update document label based on experience selection
          const documentLabels = {
            "1 Year PSW Experience": "Letter of Employment",
            "International Nurse": "Diploma and/or Transcript",
            "Caregiver Experience": "Letter from Employer",
          };

          if (documentLabels[experience]) {
            uploadLabel.textContent = documentLabels[experience];
          }
        }
        function validateFileUpload() {
          const fileInput = document.getElementById("experience_document");
          const nextButtons = document.querySelectorAll(
            ".next-button-experience"
          );
          nextButtons.forEach((nextButton) => {
            if (fileInput.files.length > 0) {
              nextButton.classList.remove("cursor-not-allowed", "opacity-50");
              nextButton.classList.add(
                "bg-teal-500",
                "hover:bg-teal-600",
                "hover:shadow-lg"
              );
              nextButton.disabled = false;
            } else {
              nextButton.classList.add("cursor-not-allowed", "bg-gray-400");
              nextButton.classList.remove(
                "bg-teal-500",
                "hover:bg-teal-600",
                "hover:shadow-lg"
              );
              nextButton.disabled = true;
            }
          });
        }
      </script>
    </div>

    <!-- Shift Requested Dropdown (Step 6) -->
    <div class="form-step hidden bg-white p-6 rounded-lg shadow-lg" id="step6">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">
        Target Shift Schedule
      </h2>
      <div class="mb-4 flex items-center gap-2 bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded shadow-sm">
        <i class="fas fa-info-circle text-yellow-500 text-lg"></i>
        <span class="text-yellow-800 text-sm sm:text-base font-medium">The facility will determine the final shift timing.</span>
      </div>
      <div class="flex flex-col">
        <label
          for="shift_requested"
          class="text-lg font-medium text-gray-700 mb-2 after:content-['*'] after:text-red-500 after:ml-1"
          >Target Shift Schedule</label
        >
        <select
          name="shift_requested"
          id="shift_requested"
          required
          class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option value="Select your shift request">
            Select your shift request
          </option>
          <option value="Monday to Friday - Morning">Monday to Friday - Morning</option>
          <option value="Monday to Friday - Evening">Monday to Friday - Evening</option>
          <option value="Saturday & Sunday - Morning">Saturday & Sunday - Morning</option>
          <option value="Saturday & Sunday - Evening">Saturday & Sunday - Evening</option>
        </select>
      </div>
      <div class="flex justify-center items-center mt-6">
        <button
          type="button"
          id="nextStepBtn7"
          class="px-6 py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 transition-all duration-300 opacity-50 cursor-not-allowed"
          onclick="nextStep(7)"
          disabled
        >
          Next <i class="fas fa-arrow-right ml-2"></i>
        </button>
      </div>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const shiftSelect = document.getElementById("shift_requested");
          const nextBtn = document.getElementById("nextStepBtn7");
      
          function updateNextBtnState() {
            if (
              shiftSelect.value === "Monday to Friday - Morning" ||
              shiftSelect.value === "Monday to Friday - Evening" ||
              shiftSelect.value === "Saturday & Sunday - Morning" ||
              shiftSelect.value === "Saturday & Sunday - Evening"
            ) {
              nextBtn.disabled = false;
              nextBtn.classList.remove("opacity-50", "cursor-not-allowed");
            } else {
              nextBtn.disabled = true;
              nextBtn.classList.add("opacity-50", "cursor-not-allowed");
            }
          }
          shiftSelect.addEventListener("change", updateNextBtnState);
          updateNextBtnState();
        });
      </script>
    </div>

    <!-- Preferred Facility (Step 9) -->
    <!-- <div class="form-step hidden" id="step7">
            <div class="flex flex-col">
                <label for="preferred_facility_name" class="text-lg font-medium text-gray-700 mb-2">Preferred Facility Name (Optional)</label>
                <input type="text" name="preferred_facility_name" id="preferred_facility_name" 
                       class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                       placeholder="Facility Name">
            </div>
            <div class="flex flex-col">
                <label for="preferred_facility_address" class="text-lg font-medium text-gray-700 mb-2">Preferred Facility Address (Optional)</label>
                <textarea name="preferred_facility_address" id="preferred_facility_address" rows="3" 
                          class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                          placeholder="Facility Address"></textarea>
            </div>
            <div class="flex flex-col">
                <label for="preferred_facility_contact_person" class="text-lg font-medium text-gray-700 mb-2">Preferred Facility Contact Person (Optional)</label>
                <input type="text" name="preferred_facility_contact_person" id="preferred_facility_contact_person" 
                       class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                       placeholder="Contact Person">
            </div>
            <div class="flex justify-center mt-4">
                <button type="button" class="px-6 py-3 bg-teal-500 text-white font-semibold rounded-full shadow-md 
               hover:bg-teal-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-400 
               transition-all duration-300" onclick="nextStep(8)">Next <i class="fas fa-arrow-right ml-2"></i></button>
            </div>
        </div> -->

    <!-- Upload Fields (All at Once) (Step 7) -->
    <div class="form-step hidden" id="step7">
      <h3 class="text-xl font-semibold text-teal-700 mb-6">
        Upload Required Documents
      </h3>

      <!-- Video Tutorial Link -->
      <div class="mb-6 flex items-center gap-2 bg-teal-50 border-l-4 border-teal-400 p-3 rounded">
        <i class="fas fa-video text-teal-500 text-lg"></i>
        <span class="text-teal-800 text-sm">For a step-by-step guide on how to have your file ready, please refer to our video tutorial
          <a href="https://youtu.be/YpwIJwhVrCc" class="text-teal-600 underline ml-1" target="_blank">Click here</a>.
        </span>
      </div>

      <div id="file-upload-section">
        <!-- Experience -->
        <div class="mb-2 text-teal-800 font-bold text-base">Experience</div>
        <div class="flex flex-col mb-4">
          <label for="experience_document" class="text-lg font-medium text-gray-700 mb-2">Experience Document</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="experience_document">
            <input type="file" name="experience_document" id="experience_document" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('experience_document')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>

        <!-- Medical Requirements -->
        <div class="mb-2 text-teal-800 font-bold text-base mt-6">Medical Requirements</div>
        <div class="flex flex-col mb-4">
          <label for="medical_certificate_form" class="text-lg font-medium text-gray-700 mb-2">Medical Report Form</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="medical_certificate_form">
            <input type="file" name="medical_certificate_form" id="medical_certificate_form" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('medical_certificate_form')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="xray_result" class="text-lg font-medium text-gray-700 mb-2">X-Ray Result</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="xray_result">
            <input type="file" name="xray_result" id="xray_result" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('xray_result')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="mmr_lab_vax_record" class="text-lg font-medium text-gray-700 mb-2">MMR Lab/Vax Record</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="mmr_lab_vax_record">
            <input type="file" name="mmr_lab_vax_record" id="mmr_lab_vax_record" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('mmr_lab_vax_record')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="varicella_lab_vax_record" class="text-lg font-medium text-gray-700 mb-2">Varicella Lab/Vax Record</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="varicella_lab_vax_record">
            <input type="file" name="varicella_lab_vax_record" id="varicella_lab_vax_record" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('varicella_lab_vax_record')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="tdap_vax_record" class="text-lg font-medium text-gray-700 mb-2">TDAP Vax Record</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="tdap_vax_record">
            <input type="file" name="tdap_vax_record" id="tdap_vax_record" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('tdap_vax_record')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="hepatitis_b_lab_vax_record" class="text-lg font-medium text-gray-700 mb-2">Hepatitis B Lab/Vax Record</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="hepatitis_b_lab_vax_record">
            <input type="file" name="hepatitis_b_lab_vax_record" id="hepatitis_b_lab_vax_record" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('hepatitis_b_lab_vax_record')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="hepatitis_a_lab_vax_record" class="text-lg font-medium text-gray-700 mb-2">Hepatitis A Lab/Vax Record</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="hepatitis_a_lab_vax_record">
            <input type="file" name="hepatitis_a_lab_vax_record" id="hepatitis_a_lab_vax_record" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('hepatitis_a_lab_vax_record')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>

        <!-- NACC Requirements -->
        <div class="mb-2 text-teal-800 font-bold text-base mt-6">NACC Requirements</div>
        <div class="flex flex-col mb-4">
          <label for="covid_vaccination_certificate" class="text-lg font-medium text-gray-700 mb-2">Covid Vaccination Certificate</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="covid_vaccination_certificate">
            <input type="file" name="covid_vaccination_certificate" id="covid_vaccination_certificate" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('covid_vaccination_certificate')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="vulnerable_sector_check" class="text-lg font-medium text-gray-700 mb-2">Vulnerable Sector Check</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="vulnerable_sector_check">
            <input type="file" name="vulnerable_sector_check" id="vulnerable_sector_check" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('vulnerable_sector_check')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="cpr_or_first_aid" class="text-lg font-medium text-gray-700 mb-2">CPR & First Aid</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="cpr_or_first_aid">
            <input type="file" name="cpr_or_first_aid" id="cpr_or_first_aid" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('cpr_or_first_aid')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="mask_fit_certificate" class="text-lg font-medium text-gray-700 mb-2">Mask Fit Certificate</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="mask_fit_certificate">
            <input type="file" name="mask_fit_certificate" id="mask_fit_certificate" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('mask_fit_certificate')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="basic_life_support" class="text-lg font-medium text-gray-700 mb-2">Basic Life Support</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="basic_life_support">
            <input type="file" name="basic_life_support" id="basic_life_support" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('basic_life_support')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="flu_shot" class="text-lg font-medium text-gray-700 mb-2">Flu Shot</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="flu_shot">
            <input type="file" name="flu_shot" id="flu_shot" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('flu_shot')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>

        <!-- Additional Facility Requirements if Required -->
        <div class="mb-2 text-teal-800 font-bold text-base mt-6">Additional Facility Requirements if Required</div>
        <div class="flex flex-col mb-4">
          <label for="resume" class="text-lg font-medium text-gray-700 mb-2">Resume</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="resume">
            <input type="file" name="resume" id="resume" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('resume')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="extra_dose_of_covid" class="text-lg font-medium text-gray-700 mb-2">Extra Dose of Covid</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="extra_dose_of_covid">
            <input type="file" name="extra_dose_of_covid" id="extra_dose_of_covid" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('extra_dose_of_covid')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
        <div class="flex flex-col mb-4">
          <label for="other_documents" class="text-lg font-medium text-gray-700 mb-2">Other Documents</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="other_documents">
            <input type="file" name="other_documents" id="other_documents" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('other_documents')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>

        <!-- Documents Required After Placement Completion -->
        <div class="mb-2 text-teal-800 font-bold text-base mt-6">Documents Required After Placement Completion</div>
        <div class="flex flex-col mb-4">
          <label for="skills_passbook" class="text-lg font-medium text-gray-700 mb-2">Skills Passbook</label>
          <div class="file-dropzone border-2 border-dashed border-teal-300 rounded-lg bg-white flex flex-col items-center justify-center py-5 px-3 transition hover:border-teal-500 relative" data-input="skills_passbook">
            <input type="file" name="skills_passbook" id="skills_passbook" accept="application/pdf" class="hidden" />
            <div class="flex flex-col items-center justify-center pointer-events-none select-none">
              <i class="fas fa-file-pdf text-2xl text-teal-400 mb-1"></i>
              <span class="text-teal-700 text-xs">Drag & drop your PDF here, or <span class="underline text-teal-600 cursor-pointer pointer-events-auto select-auto" onclick="triggerFileInput('skills_passbook')">browse</span></span>
              <span class="text-xs text-gray-500 mt-1">PDF only, max 2MB</span>
            </div>
            <div class="file-info mt-1 text-teal-700 text-xs hidden"></div>
            <div class="file-error mt-1 text-red-600 text-xs hidden"></div>
          </div>
        </div>
      </div>

      <!-- Loading Spinner & Background Blur -->
      <div id="loading-overlay" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-teal-900 bg-opacity-40 backdrop-blur-sm">
        <div class="bg-white/90 rounded-2xl shadow-2xl flex flex-col items-center px-10 py-8 min-w-[320px] max-w-[90vw] border border-teal-200 relative">
          <img src="/static/images/peak_logo.png" alt="Peak College Logo" class="w-16 h-16 object-contain rounded-xl shadow mb-4 bg-white" onerror="this.style.display='none'" />
          <div class="relative flex items-center justify-center mb-6">
            <div class="w-14 h-14 border-4 border-teal-200 border-t-teal-500 rounded-full animate-spin"></div>
            <div class="absolute w-8 h-8 bg-teal-100 rounded-full flex items-center justify-center shadow-inner">
              <i class="fas fa-cloud-upload-alt text-teal-500 text-2xl"></i>
            </div>
          </div>
          <p class="text-lg text-teal-900 font-semibold text-center mb-2">Submitting your placement profile...</p>
          <p class="text-sm text-gray-600 text-center">Please do not close or refresh this page.</p>
        </div>
      </div>
      <style>
        #loading-overlay {
          animation: classy-fade-in 0.4s ease;
        }
        @keyframes classy-fade-in {
          from { opacity: 0; }
          to { opacity: 1; }
        }
      </style>

      <div class="flex justify-center mt-6">
        <button
          id="submitBtn"
          type="submit"
          class="px-6 py-3 bg-gradient-to-r from-teal-400 to-teal-500 text-white font-semibold rounded-full shadow-lg hover:from-teal-500 hover:to-teal-600 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-teal-300"
        >
          Submit
        </button>
      </div>
      <script>
        // Helper to trigger file input
        function triggerFileInput(id) {
          document.getElementById(id).click();
        }

        // Drag and drop logic for all dropzones
        document.addEventListener("DOMContentLoaded", function () {
          const allFields = [
            "experience_document",
            "medical_certificate_form",
            "xray_result",
            "mmr_lab_vax_record",
            "varicella_lab_vax_record",
            "tdap_vax_record",
            "hepatitis_b_lab_vax_record",
            "hepatitis_a_lab_vax_record",
            "covid_vaccination_certificate",
            "vulnerable_sector_check",
            "cpr_or_first_aid",
            "mask_fit_certificate",
            "basic_life_support",
            "flu_shot",
            "resume",
            "extra_dose_of_covid",
            "other_documents",
            "skills_passbook"
          ];
          document.querySelectorAll(".file-dropzone").forEach(function (dropzone) {
            const inputId = dropzone.getAttribute("data-input");
            const fileInput = document.getElementById(inputId);
            const fileInfo = dropzone.querySelector(".file-info");
            const fileError = dropzone.querySelector(".file-error");

            // Drag events
            dropzone.addEventListener("dragover", function (e) {
              e.preventDefault();
              dropzone.classList.add("border-teal-500", "bg-teal-50");
            });
            dropzone.addEventListener("dragleave", function (e) {
              e.preventDefault();
              dropzone.classList.remove("border-teal-500", "bg-teal-50");
            });
            dropzone.addEventListener("drop", function (e) {
              e.preventDefault();
              dropzone.classList.remove("border-teal-500", "bg-teal-50");
              const file = e.dataTransfer.files[0];
              handleFile(file, fileInput, fileInfo, fileError);
            });
            // Click to browse
            dropzone.addEventListener("click", function (e) {
              if (e.target.classList.contains("pointer-events-auto")) return;
              fileInput.click();
            });
            // File input change
            fileInput.addEventListener("change", function () {
              const file = fileInput.files[0];
              handleFile(file, fileInput, fileInfo, fileError);
            });
          });

          function handleFile(file, fileInput, fileInfo, fileError) {
            fileInfo.classList.add("hidden");
            fileError.classList.add("hidden");
            fileInfo.textContent = "";
            fileError.textContent = "";
            if (!file) return;
            // Check type
            if (file.type !== "application/pdf") {
              fileError.textContent = "Only PDF files are allowed.";
              fileError.classList.remove("hidden");
              fileInput.value = "";
              return;
            }
            // Check size
            if (file.size > 2 * 1024 * 1024) {
              fileError.textContent = "File size must be 2MB or less.";
              fileError.classList.remove("hidden");
              fileInput.value = "";
              return;
            }
            // Show file info
            fileInfo.textContent = `Selected: ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`;
            fileInfo.classList.remove("hidden");
          }
        });
      </script>
      <style>
        .file-dropzone {
          min-height: 80px;
          cursor: pointer;
          transition: border-color 0.2s, background 0.2s;
        }
        .file-dropzone.bg-teal-50 {
          background: #f0fdfa;
        }
        .file-dropzone .fa-file-pdf {
          color: #38b2ac;
        }
        .file-info {
          color: #319795;
        }
        .file-error {
          color: #e53e3e;
        }
      </style>
    </div>

    <!-- Custom File Input Style -->
    <style>
      .file-input-container {
        position: relative;
        width: 100%;
      }

      /* Style the default file input */
      .file-input-container input[type="file"] {
        display: block;
        width: 100%;
        padding: 12px 20px;
        background-color: #f3f4f6;
        color: #4b5563;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
      }

      .file-input-container input[type="file"]:hover {
        background-color: #e1e8ed;
        border-color: #38b2ac;
      }

      .file-input-container input[type="file"]:focus {
        outline: none;
        border-color: #38b2ac;
        background-color: #d1f1f1;
      }

      .file-input-container input[type="file"]:active {
        background-color: #38b2ac;
        color: white;
      }

      /* Optional styling for a nice visual effect */
      .file-input-container input[type="file"]::-webkit-file-upload-button {
        cursor: pointer;
        background-color: #38b2ac;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
      }

      .file-input-container
        input[type="file"]::-webkit-file-upload-button:hover {
        background-color: #319795;
      }

      .file-input-container
        input[type="file"]::-webkit-file-upload-button:focus {
        outline: none;
      }
    </style>

    <!-- JavaScript for handling form submission -->
    <script>
      function showLoadingOverlay() {
        const submitButton = document.getElementById("submitBtn");
        const loadingOverlay = document.getElementById("loading-overlay");

        // Disable the submit button to prevent multiple submissions
        submitButton.disabled = true;
        submitButton.classList.add("opacity-50", "cursor-not-allowed");

        // Show the loading overlay
        loadingOverlay.classList.remove("hidden");
      }
    </script>

    <script>
      function setUserExperience() {
        const experienceSelect = document.getElementById("experience_level");
        const experience = experienceSelect.value;
        if (experience === "No Experience") {
          localStorage.setItem("user_experience", "No Experience");
          // nextButtons.forEach((btn) => btn.click());
        }
      }

      function handleExperienceChangeSelect() {
        const experienceSelect = document.getElementById("experience_level");
        const nextButtonExperience = document.querySelector(
          ".next-button-experience-select"
        );

        if (experienceSelect.value === "Select your experience") {
          nextButtonExperience.setAttribute("disabled", "true");
          nextButtonExperience.classList.add(
            "opacity-50",
            "cursor-not-allowed"
          );
        } else {
          nextButtonExperience.removeAttribute("disabled");
          nextButtonExperience.classList.remove(
            "opacity-50",
            "cursor-not-allowed"
          );
        }
      }

      // Attach event listener to select dropdown
      document
        .getElementById("experience_level")
        .addEventListener("change", handleExperienceChangeSelect);

      // Ensure button starts as disabled
      document.addEventListener("mousemove", handleExperienceChangeSelect);
    </script>
    <script>
      function handleExperienceChange() {
        const experienceSelect = document.getElementById("experience_level");
        const experience = experienceSelect.value;
        const uploadDiv = document.getElementById("document_upload");
        const uploadLabel = document.getElementById("document_label");
        const step4nextButton = document.querySelector("#step4 button");
        const nextButtons = document.querySelectorAll(
          ".next-button-experience"
        ); // Select all buttons
        const nextButtonExperience = document.querySelector(
          ".next-button-experience"
        );

        console.log(experience);
        console.log(experience === "No Experience");

        // Save "No Experience" in local storage and auto-click next button

        // Enable/Disable the Next button in step 4
        if (experience !== "No Experience") {
          step4nextButton.disabled = false;
          step4nextButton.classList.remove("opacity-50", "cursor-not-allowed");
        } else {
          console.log("No Experience");
        }

        // Show/Hide document upload section
        if (experience === "No Experience") {
          uploadDiv.classList.add("hidden");

          nextButtons.forEach((btn) => {
            btn.classList.remove("cursor-not-allowed", "bg-gray-400");
            btn.classList.add(
              "bg-teal-500",
              "hover:bg-teal-600",
              "hover:shadow-lg"
            );
            // btn.disabled = false;
          });
        } else {
          uploadDiv.classList.remove("hidden");

          nextButtonExperience.classList.add(
            "opacity-50",
            "cursor-not-allowed"
          );
        }

        const sampleNote = document.getElementById("sampleNote");
        const noteText = document.getElementById("noteText");

        // Show or hide sample note based on selection
        if (experience === "International Nurse") {
          sampleNote.classList.add("hidden");
          noteText.textContent =
            "Note: If the submitted document/s lack all necessary information, the document will be rejected.";
        } else {
          sampleNote.classList.remove("hidden");
          noteText.textContent =
            "Note: If the submitted document/s lack all necessary information, the document will be rejected.";
        }

        // Update document label based on experience selection
        const documentLabels = {
          "1 Year PSW Experience": "Letter of Employment",
          "International Nurse": "Diploma and/or Transcript",
          "Caregiver Experience": "Letter from Employer",
        };

        if (documentLabels[experience]) {
          uploadLabel.textContent = documentLabels[experience];
        }
      }
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const checkbox = document.getElementById("responsibilitiesCheckbox");
        const errorText = document.getElementById("checkboxError");
        const nextButton = document.getElementById("nextButton");

        // Initially disable the Next button
        nextButton.disabled = true;
        nextButton.classList.add("opacity-50", "cursor-not-allowed");

        // Enable or disable the button based on checkbox state
        checkbox.addEventListener("change", function () {
          if (checkbox.checked) {
            nextButton.disabled = false;
            nextButton.classList.remove("opacity-50", "cursor-not-allowed");
            errorText.classList.add("hidden");
          } else {
            nextButton.disabled = true;
            nextButton.classList.add("opacity-50", "cursor-not-allowed");
          }
        });

        // Prevent proceeding if the checkbox isn't checked
        nextButton.addEventListener("click", function (event) {
          if (!checkbox.checked) {
            errorText.classList.remove("hidden");
            event.preventDefault();
          }
        });
      });

      function nextStep(step) {
        if (document.getElementById("responsibilitiesCheckbox").checked) {
          document.getElementById("step1").classList.add("hidden");
          document.getElementById(`step${step}`).classList.remove("hidden");
        }
      }
    </script>
    <script>
      function validateFileUpload() {
        const fileInput = document.getElementById("experience_document");
        const nextButtons = document.querySelectorAll(
          ".next-button-experience"
        ); // Select all buttons

        nextButtons.forEach((nextButton) => {
          if (fileInput.files.length > 0) {
            nextButton.classList.remove("cursor-not-allowed", "opacity-50");
            nextButton.classList.add(
              "bg-teal-500",
              "hover:bg-teal-600",
              "hover:shadow-lg"
            );

            nextButton.disabled = false;
          } else {
            nextButton.classList.add("cursor-not-allowed", "bg-gray-400");
            nextButton.classList.remove(
              "bg-teal-500",
              "hover:bg-teal-600",
              "hover:shadow-lg"
            );
            nextButton.disabled = true;
          }
        });
      }
    </script>
  </form>
</div>

{% comment %}
<script>
  document
    .getElementById("validate-password-btn")
    .addEventListener("click", async () => {
      const password = document.getElementById("password").value;
      const messageContainer = document.getElementById("message-container");

      try {
        const response = await fetch("/validate-password/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ password }),
        });

        if (response.ok) {
          const result = await response.json();
          if (result.valid) {
            // Show success message
            messageContainer.textContent = "Password is valid!";
            messageContainer.style.color = "green";
            messageContainer.style.display = "block";

            // Show "Next" button and hide "Validate Password" button
            document.getElementById("next-btn").style.display = "block";
            document.getElementById("validate-password-btn").style.display =
              "none";
          } else {
            // Show error message
            messageContainer.textContent =
              "Invalid password. Please try again.";
            messageContainer.style.color = "red";
            messageContainer.style.display = "block";
          }
        } else {
          messageContainer.textContent =
            "An error occurred while validating the password.";
          messageContainer.style.color = "red";
          messageContainer.style.display = "block";
        }
      } catch (error) {
        console.error("Error validating password:", error);
        messageContainer.textContent =
          "Could not validate password. Please check your connection.";
        messageContainer.style.color = "red";
        messageContainer.style.display = "block";
      }
    });
</script>
{% endcomment %}

<script>
  let currentStep = 1;

  function nextStep() {
    clearErrors();

    const currentStepElement = document.querySelector(`#step${currentStep}`);
    if (!validateStep(currentStepElement)) return; // Stop if validation fails

    currentStep++;

    // Check if userExperience is "No Experience" and current step is 5, then skip to 6
    let userExperience = localStorage.getItem("user_experience");
    if (userExperience === "No Experience" && currentStep === 5) {
      console.log("Skipping step 5 due to No Experience");
      currentStep = 6;
    }

    updateStep();
  }

  function prevStep() {
    if (currentStep > 1) {
      // Check if "user_experience" exists and equals "No Experience"
      let userExperience = localStorage.getItem("user_experience");

      if (userExperience === "No Experience" && currentStep === 6) {
        currentStep = 4; // Skip step 5 and go directly to step 4
        localStorage.removeItem("user_experience"); // Clear the stored experience
      } else {
        currentStep--; // Normal behavior
      }

      updateStep(); // Update the step display
    }
  }

  function updateStep() {
    const steps = document.querySelectorAll(".form-step");
    steps.forEach((step) => step.classList.add("hidden"));

    document.getElementById(`step${currentStep}`).classList.remove("hidden");

    document
      .getElementById("backButton")
      .classList.toggle("hidden", currentStep === 1);
  }

  function validateStep(step) {
    let isValid = true;
    const inputs = step.querySelectorAll("input[required], select[required]");

    inputs.forEach((input) => {
      if (!input.value.trim()) {
        showError(input, "This field is required.");
        isValid = false;
      }
    });

    if (step.id === "step1") {
      const emailInput = step.querySelector("#college_email");
      if (emailInput && !emailInput.value.endsWith("@peakcollege.ca")) {
        showError(emailInput, "Email must end with @peakcollege.ca");
        isValid = false;
      }
    }

    if (step.id === "step7") {
      const experienceLevel = document.querySelector("#experience_level");
      const employerLetter = step.querySelector("#employer_letter_input");

      if (
        experienceLevel &&
        employerLetter &&
        (experienceLevel.value === "1 Year PSW Experience" ||
          experienceLevel.value === "International Nurse")
      ) {
        if (!employerLetter.files.length) {
          showError(
            employerLetter,
            "Note: If you don't have the letter, you'll not be able to move forward with the application till you select 'No Experience: 300 hrs'."
          );
          isValid = false;
        }
      }
    }

    return isValid;
  }

  function showError(input, message) {
    const errorElement = document.createElement("p");
    errorElement.classList.add("text-sm", "text-red-500", "mt-2");
    errorElement.textContent = message;
    input.parentNode.appendChild(errorElement);
  }

  function clearErrors() {
    document.querySelectorAll(".text-red-500").forEach((el) => el.remove());
  }

  document.addEventListener("DOMContentLoaded", () => updateStep());

  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("wizardForm");
    const collegeEmail = document.getElementById("college_email");
    const addressUpdated = document.getElementById("address_updated");
    const experienceLevel = document.getElementById("experience_level");
    const employerLetter = document.getElementById("employer_letter_input");

    function showError(input, message) {
      const errorElement = document.createElement("p");
      errorElement.classList.add("text-sm", "text-red-500", "mt-2");
      errorElement.textContent = message;
      input.parentNode.appendChild(errorElement);
    }

    function clearErrors() {
      document.querySelectorAll(".text-red-500").forEach((el) => el.remove());
    }

    function validateEmail() {
      if (!collegeEmail.value.endsWith("@peakcollege.ca")) {
        showError(collegeEmail, "Email must end with @peakcollege.ca");
        return false;
      }
      return true;
    }

    function validateEmployerLetter() {
      if (
        experienceLevel.value === "1 Year PSW Experience" &&
        !employerLetter.files.length
      ) {
        showError(
          employerLetter,
          "Letter from Employer is mandatory for this experience level."
        );
        return false;
      }
      if (
        experienceLevel.value === "International Nurse" &&
        !employerLetter.files.length
      ) {
        showError(
          employerLetter,
          "Diploma and/or transcript is mandatory for this experience level."
        );
        return false;
      }
      return true;
    }

    function handleAddressChange() {
      if (addressUpdated.value === "Yes") {
        window.open(
          "https://docs.google.com/forms/d/1AjR2hpVOLnUY9qT8a-mzdV4LVpMnwRPZydsavp7aDBY/edit",
          "_blank"
        );
      }
    }

    addressUpdated.addEventListener("change", handleAddressChange);
    experienceLevel.addEventListener("change", validateEmployerLetter);

    form.addEventListener("submit", function (event) {
      clearErrors();
      let valid = true;

      if (!validateEmail()) valid = false;
      if (!validateEmployerLetter()) valid = false;

      if (!valid) event.preventDefault();
    });
  });
</script>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    setTimeout(() => {
      // Clear local storage
      localStorage.removeItem("user_experience");
      handleExperienceChangeSelect();

      // Reset the select dropdown to its default option
      let experienceSelect = document.getElementById("experience_level");
      if (experienceSelect) {
        experienceSelect.selectedIndex = 0; // Reset to the first option
      }

      // Call experience change handler after resetting the dropdown
      handleExperienceChange();
    }, 0);
  });
</script>
<script>
  function goToSubStep(step) {
    const currentStep = step - 1;
    const checkbox = document.getElementById(`subStep${currentStep}Checkbox`);
    const error = document.getElementById(`subStep${currentStep}Error`);

    if (!checkbox.checked) {
      error.classList.remove("hidden");
      return;
    }

    error.classList.add("hidden");

    document
      .querySelectorAll(".sub-step")
      .forEach((el) => el.classList.add("hidden"));
    document.getElementById(`subStep${step}`).classList.remove("hidden");
  }

  function goToSubStepBack(step) {
    // Hide current substep
    document.getElementById(`subStep${step}`).classList.add("hidden");
    // Show previous substep
    document.getElementById(`subStep${step - 1}`).classList.remove("hidden");
  }

  function finishSubSteps() {
    const checkbox = document.getElementById(`subStep7Checkbox`);
    const error = document.getElementById(`subStep7Error`);

    if (!checkbox.checked) {
      error.classList.remove("hidden");
      return;
    }

    error.classList.add("hidden");
    alert("All sub-steps acknowledged! You may proceed.");
  }
</script>
<style>
  .sub-step {
    margin-top: 1.5rem;
  }
  .card {
    background: #e6fffa;
    border-left: 4px solid #38b2ac;
    padding: 1.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }
  .card h3 {
    color: #2c7a7b;
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }
  .card ul {
    list-style-type: disc;
    padding-left: 1.5rem;
    color: #2d3748;
    margin-bottom: 1rem;
  }
  .acknowledge {
    margin-top: 1rem;
  }
  .error {
    color: #e53e3e;
    font-size: 1rem;
    margin-top: 0.5rem;
  }
  .hidden {
    display: none;
  }
  button {
    margin-top: 1rem;
    background-color: #38b2ac;
    color: white;
    padding: 0.5rem 1.5rem;
    border-radius: 9999px;
    font-weight: 600;
    transition: background-color 0.3s;
  }
  button:hover {
    background-color: #319795;
  }
</style>

<!-- Move modal here, outside the form -->
<div id="pregnancyPolicyModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
  <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-2 p-6 sm:p-10 relative overflow-y-auto max-h-[90vh]">
    <h1 class="text-2xl sm:text-3xl font-bold text-teal-700 mb-4 text-center">Pregnancy Policy & Waiver for Clinical Placement</h1>
    <div class="text-gray-700 space-y-4 text-sm sm:text-base">
      <section>
        <h2 class="font-semibold text-lg mb-1">Objective</h2>
        <p>To ensure the health and safety of pregnant students during clinical/community placements while maintaining compliance with Ministry, workplace, and insurance requirements.</p>
      </section>
      <section>
        <h2 class="font-semibold text-lg mb-1">1. Student Disclosure and Confidentiality</h2>
        <ul class="list-disc list-inside ml-4">
          <li>Pregnancy disclosure is voluntary but strongly encouraged to allow the college to plan for the student's safety.</li>
          <li>All information disclosed will be treated with strict confidentiality and shared only with essential personnel (e.g., placement coordinator, clinical instructor) with student consent.</li>
        </ul>
      </section>
      <section>
        <h2 class="font-semibold text-lg mb-1">2. Medical Clearance Requirement</h2>
        <ul class="list-disc list-inside ml-4">
          <li>Students must submit a Medical Clearance Letter stating they are fit for placement, including:</li>
          <ul class="ml-6 list-disc">
            <li>Fitness to attend placement</li>
            <li>Any restrictions (lifting, night shifts, etc.)</li>
            <li>Expected due date</li>
          </ul>
        </ul>
      </section>
      <section>
        <h2 class="font-semibold text-lg mb-1">3. Placement Risk Assessment</h2>
        <p>The college will assess site safety, including task reviews and coordination with the placement facility for accommodations.</p>
      </section>
      <section>
        <h2 class="font-semibold text-lg mb-1">4. Waiver of Liability</h2>
        <p>Students must sign a waiver accepting all risks and releasing the college from liability.</p>
        <blockquote class="border-l-4 border-teal-500 pl-4 italic text-gray-600 bg-gray-50 py-2 rounded mt-2">"I, [Student Full Name], acknowledge that I am currently pregnant and have been advised of the risks associated with clinical/community placements during pregnancy. I have provided medical clearance and wish to proceed with placement. I understand and accept all associated risks and hereby release Peak Private Healthcare College from any liability related to my participation in the placement while pregnant."</blockquote>
      </section>
      <section>
        <h2 class="font-semibold text-lg mb-1">5. Accommodation & Deferral Options</h2>
        <p>Students may postpone, defer, or request alternatives if placement is deemed unsafe.</p>
      </section>
      <section>
        <h2 class="font-semibold text-lg mb-1">6. Return After Maternity Leave</h2>
        <ul class="list-disc list-inside ml-4">
          <li>Submit Return to Placement medical clearance</li>
          <li>Meet with placement coordinator</li>
          <li>Resume placement subject to availability</li>
        </ul>
      </section>
      <section>
        <h2 class="font-semibold text-lg mb-1">7. Academic Continuity</h2>
        <p>Students should stay engaged in theory classes. Missed hours must be made up per college policy.</p>
      </section>
      <section>
        <h2 class="font-semibold text-lg mb-1">8. Compliance</h2>
        <p>Policy aligns with Ontario Human Rights Code and Ministry expectations. The college may defer placement for safety.</p>
      </section>
    </div>
    <form id="pregnancySignatureForm" class="mt-8 space-y-6">
      <div class="pb-4">
        <label class="block text-teal-700 font-semibold mb-2">Upload Signature (Image Only)</label>
        <div id="signatureDropzone" class="flex flex-col items-center justify-center border-2 border-dashed border-teal-400 rounded-lg bg-teal-50 py-8 px-4 transition hover:border-teal-600 cursor-pointer relative min-h-[120px]" style="padding-top: 2rem; padding-bottom: 2rem;">
          <input type="file" id="pregnancy_signature_file" name="pregnancy_signature_file" accept="image/*" class="hidden" />
          <div id="signaturePreview" class="flex flex-col items-center w-full"></div>
          <div id="signatureDropText" class="text-teal-700 text-sm">Drag & drop your signature image here, or <span class="underline text-teal-600 cursor-pointer" onclick="document.getElementById('pregnancy_signature_file').click()">browse</span></div>
          <div id="signatureError" class="text-red-600 text-xs mt-2 hidden"></div>
        </div>
      </div>
      <div>
        <label for="signed_on_date" class="block text-teal-700 font-semibold mb-2">Date Signed</label>
        <input type="date" id="signed_on_date" name="signed_on_date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-400" required />
        <div id="dateError" class="text-red-600 text-xs mt-2 hidden"></div>
      </div>
      <div class="flex justify-end gap-2">
        <button type="button" onclick="closePregnancyModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 font-semibold">Cancel</button>
        <button type="button" id="waiverSaveBtn" class="px-6 py-2 bg-teal-600 text-white rounded hover:bg-teal-700 font-semibold shadow">Save</button>
      </div>
    </form>
  </div>
</div>

{% endblock %}
